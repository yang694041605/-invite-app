# 客户授权码管理功能文档

## 概述

本文档详细描述了福彩3D智能预测系统中客户授权码管理功能的实现细节和使用方法。该功能允许管理员生成、管理和监控客户授权码，控制客户对系统的访问权限。

## 功能特点

### 1. 授权码生成

- **8位纯数字授权码**：生成唯一的8位数字组合作为授权码
- **灵活的有效期设置**：支持设置1天、5天、30天、90天、180天、360天的有效期
- **客户信息记录**：记录每个授权码对应的客户名称
- **自动过期机制**：授权码过期后自动失效

### 2. 授权码管理

- **实时状态监控**：显示授权码的当前状态（正常、已过期、已吊销）
- **授权码吊销**：支持随时吊销已生成的授权码
- **搜索功能**：支持按客户名称搜索授权码
- **复制功能**：一键复制授权码方便发送给客户

### 3. 客户登录历史记录

- **详细登录信息**：记录客户名称、授权码、登录时间、IP地址、设备信息
- **自动关联客户信息**：登录记录自动关联授权码对应的客户信息
- **搜索功能**：支持按客户名称或授权码搜索登录记录
- **记录限制**：只保留最近的50条登录记录

## 技术实现

### 数据存储

所有授权码和登录历史数据均存储在浏览器的localStorage中：

- `authCodes`：存储所有授权码信息的数组
- `loginHistory`：存储所有登录历史记录的数组

### 数据结构

#### 授权码数据结构

```javascript
{
  customerName: "客户名称",
  authCode: "8位数字授权码",
  generateTime: 生成时间戳,
  expireDays: 有效期天数,
  expireTime: 过期时间戳,
  status: "active" | "expired" | "revoked"
}
```

#### 登录历史数据结构

```javascript
{
  customerName: "客户名称",
  authCode: "使用的授权码",
  loginTime: 登录时间戳,
  ip: "IP地址",
  userAgent: "浏览器用户代理信息"
}
```

### 核心函数

#### 1. 生成授权码

```javascript
function generateAuthCode() {
  // 获取客户名称和有效期
  // 生成唯一的8位数字授权码
  // 计算过期时间
  // 创建授权码对象
  // 保存到localStorage
  // 更新授权码列表显示
}
```

#### 2. 更新授权码列表

```javascript
function updateAuthCodesList(searchTerm = '') {
  // 从localStorage获取授权码列表
  // 过滤过期的授权码
  // 根据搜索词筛选
  // 按生成时间排序
  // 生成表格HTML
  // 更新页面显示
}
```

#### 3. 记录登录历史

```javascript
function recordCustomerLogin(authCode) {
  // 根据授权码查找客户信息
  // 创建登录记录对象
  // 添加到登录历史记录
  // 限制记录数量为50条
  // 保存到localStorage
}
```

## 使用方法

### 1. 生成授权码

1. 点击导航栏中的"权限管理"
2. 在"客户授权码管理"区域输入客户名称
3. 选择授权有效期
4. 点击"生成授权码"按钮
5. 系统会生成8位数字授权码并显示在下方
6. 点击复制按钮可将授权码复制到剪贴板
7. 将授权码发送给客户

### 2. 管理授权码

1. 在"客户授权码列表"区域可以查看所有授权码
2. 可以按客户名称搜索授权码
3. 点击"吊销"按钮可以吊销指定授权码
4. 点击"复制"按钮可以复制授权码

### 3. 查看登录历史

1. 在"客户登录历史记录"区域可以查看所有登录记录
2. 可以按客户名称或授权码搜索登录记录
3. 登录记录显示客户名称、授权码、登录时间、IP地址和设备信息

## 测试功能

系统提供了专门的测试页面`test-auth-code.html`，可以用于测试以下功能：

1. 生成授权码
2. 验证授权码有效性
3. 模拟客户登录
4. 查看授权码列表
5. 查看登录历史记录
6. 吊销授权码
7. 清空数据

## 注意事项

1. 所有数据存储在浏览器的localStorage中，清除浏览器数据会导致授权码和登录记录丢失
2. 授权码生成后请及时保存，系统不会自动备份
3. 客户登录时需要输入正确的授权码才能访问系统
4. 授权码过期或吊销后，客户将无法登录系统
5. 登录历史记录最多保留50条，超过后会自动删除最早的记录

## 后续优化建议

1. 添加批量生成授权码功能
2. 实现授权码导入导出功能
3. 添加客户信息管理功能
4. 增加授权码使用统计功能
5. 实现数据自动备份功能
